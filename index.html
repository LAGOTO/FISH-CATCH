<!doctype html>
<html lang="bg">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ò–≥—Ä–∞–π ‚Äì –ö—ä—Å–º–µ—Ç –∑–∞ —É–ª–æ–≤–∞</title>
  <style>
    :root{
      --sea1:#0c2747; --sea2:#144a7a; --sky2:#cfeaff; --ui:#ffffff; --accent:#7bd389; --muted:#cfe2f5;
      --glass: rgba(255,255,255,.12); --glass-b: rgba(255,255,255,.18);
    }
    html,body{height:100%;margin:0}
    body{
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial,sans-serif;
      background:linear-gradient(#071426,#0a1b2a); color:var(--ui);
      display:flex; align-items:center; justify-content:center
    }

    /* —Ñ–∏–∫—Å–∏—Ä–∞–Ω–∞ –≤–∏—Å–æ—á–∏–Ω–∞ –∑–∞ —Å—Ç–∞–±–∏–ª–µ–Ω –ø—Ä–µ–≥–ª–µ–¥ –Ω–∞–≤—Å—è–∫—ä–¥–µ */
    .game{
      width:min(1100px,96vw);
      height:min(680px,78vh);
      position:relative; border-radius:20px; overflow:hidden;
      box-shadow:0 18px 50px rgba(0,0,0,.55);
      background:radial-gradient(1200px 600px at 50% -40%, var(--sky2), var(--sea1) 60%);
    }

    header{position:absolute; left:12px; right:12px; top:12px; display:flex; justify-content:space-between; align-items:center; z-index:8}
    .brand{font-weight:800; letter-spacing:.4px}
    .pill{backdrop-filter: blur(6px); background:var(--glass); border:1px solid var(--glass-b); padding:6px 10px; border-radius:999px; font-weight:700}

    .lake{position:absolute; inset:0;}
    .water{position:absolute; left:0; right:0; top:20%; bottom:0; background:linear-gradient(180deg, var(--sea2), var(--sea1));}
    .shore{position:absolute; left:0; right:0; bottom:0; height:14%; background:linear-gradient(180deg,#3c2b1a,#24190f);}
    .ripples{position:absolute; inset:0; pointer-events:none; z-index:20}

    /* –≥—Ä–∏–¥ (3√ó3), –±–ª–∏–∑–∫–∏—Ç–µ –∑–æ–Ω–∏ —Å–∞ –¥–æ–ª—É */
    .grid{
      position:absolute; left:6%; right:6%; top:18%; bottom:18%;
      display:grid; grid-template-columns:repeat(3,1fr); grid-template-rows:repeat(3,1fr);
      gap:12px; z-index:6;
    }
    .grid.locked{ pointer-events:none; opacity:0.9; }

    .cell{
      position:relative; border-radius:12px;
      outline:2px dashed rgba(255,255,255,.55);
      background:rgba(255,255,255,.08);
      cursor:pointer; transition:transform .08s ease, background .15s ease;
      display:flex; align-items:center; justify-content:center;
    }
    .cell:hover{transform:translateY(-2px); background:rgba(255,255,255,.16)}
    .cell span{position:absolute; left:8px; top:6px; font-size:12px; color:var(--muted)}
    .cell b{font-size:22px; color:#fff; opacity:.9}

    /* —Å—Ç–∞—Ä—Ç –æ—É–≤—ä—Ä–ª–µ–π ‚Äì –≤–∏–Ω–∞–≥–∏ –æ—Ç–≥–æ—Ä–µ, –µ–¥–∏–Ω –±—É—Ç–æ–Ω */
    .overlay{position:absolute; inset:0; display:grid; place-items:center; z-index:50}
    .card{background:rgba(0,0,0,.35); border:1px solid rgba(255,255,255,.18); border-radius:16px; padding:22px}
    button{cursor:pointer; border:0; border-radius:12px; padding:10px 14px; font-weight:800}
    .btn{background:var(--accent)}

    /* —Å–ø–ª–∞—à/—Å–ø–∏–Ω—ä—Ä/–ø–æ–ø –±–∞–ª–æ–Ω */
    .splash{position:absolute; width:8px; height:8px; border-radius:50%; background:#fff; opacity:.9; pointer-events:none; transform:translate(-50%,-50%); animation:splash 1.2s ease-out forwards}
    @keyframes splash{0%{box-shadow:0 0 0 0 rgba(255,255,255,.6)}100%{box-shadow:0 0 0 30px rgba(255,255,255,0); opacity:0}}
    .spinner{position:absolute; transform:translate(-50%,-50%); width:28px; height:28px; border-radius:50%; border:3px solid rgba(255,255,255,.35); border-top-color:#fff; animation:spin .8s linear infinite; z-index:14}
    @keyframes spin{to{transform:translate(-50%,-50%) rotate(360deg)}}
    .bubble{
      position:absolute; transform:translate(-50%,-100%) scale(.92); transform-origin:50% 100%;
      background:rgba(0,0,0,.35); border:1px solid var(--glass-b); border-radius:14px;
      padding:10px 12px; min-width:220px; z-index:15; opacity:0; animation:pop .18s ease-out forwards;
    }
    .bubble::after{content:""; position:absolute; left:50%; bottom:-10px; transform:translateX(-50%); border:10px solid transparent; border-top-color:rgba(0,0,0,.35)}
    .b-row{display:grid; grid-template-columns:auto 1fr; gap:6px 10px; font-size:14px}
    .b-title{margin:0 0 6px; font-weight:800}
    .b-actions{display:flex; gap:8px; margin-top:8px}
    @keyframes pop{from{opacity:0; transform:translate(-50%,-100%) scale(.92)} to{opacity:1; transform:translate(-50%,-100%) scale(1)}}

    footer{position:absolute; inset:auto 12px 10px 12px; color:#d0e2f6; font-size:12px; display:flex; justify-content:space-between}
  </style>
</head>
<body>
  <div class="game" id="game">
    <header>
      <div class="brand">LAGO ‚Äì HASWING</div>
      <div class="pill">–•–≤—ä—Ä–ª—è–π!</div>
    </header>

    <div class="lake">
      <div class="water"></div>
      <div class="grid" id="grid"></div>
      <div class="ripples" id="ripples"></div>
      <div class="shore"></div>
    </div>

    <!-- —Å–∞–º–æ –±—É—Ç–æ–Ω –°—Ç–∞—Ä—Ç -->
    <div class="overlay" id="start">
      <div class="card">
        <button class="btn" id="play">–°—Ç–∞—Ä—Ç</button>
      </div>
    </div>

    <footer>
      <div>–°—ä–≤–µ—Ç: –±–ª–∏–∑–∫–∏—Ç–µ –∫–≤–∞–¥—Ä–∞—Ç–∏ —Å–∞ –ø–æ-–ø–ª–∏—Ç–∫–∏; –¥–∞–ª–µ—á–Ω–∏—Ç–µ ‚Äì –ø–æ-–¥—ä–ª–±–æ–∫–∏.</div>
      <div>¬© Lago.bg</div>
    </footer>
  </div>

<script>
(() => {
  'use strict';

  // —Å—Ç–∞—Ä—Ç–∏—Ä–∞–º–µ init —Å—Ç–∞–±–∏–ª–Ω–æ (–∞–∫–æ DOM –≤–µ—á–µ –µ –≥–æ—Ç–æ–≤)
  if (document.readyState === 'loading') { document.addEventListener('DOMContentLoaded', init); } else { init(); }

  function init(){
    const grid = document.getElementById('grid');
    const ripples = document.getElementById('ripples');
    const startUI = document.getElementById('start');
    const playBtn = document.getElementById('play');

    // ===== –ê—É–¥–∏–æ: –µ–¥–∏–Ω–µ–Ω ‚Äû–ø–æ–ø‚Äú –∑–≤—É–∫ –ø—Ä–∏ –ø–æ–∫–∞–∑–≤–∞–Ω–µ –Ω–∞ —Ä–µ–∑—É–ª—Ç–∞—Ç =====
    let actx;
    const ctx = () => actx || (actx = new (window.AudioContext||window.webkitAudioContext)());
    function ensureAudio(){ try{ const a=ctx(); if(a.state==='suspended') a.resume(); }catch(e){} }
    function popSound(){
      ensureAudio();
      const a=ctx(); const o=a.createOscillator(); const g=a.createGain();
      o.type='triangle'; o.frequency.value=420; g.gain.value=0.18;
      o.connect(g); g.connect(a.destination);
      const t=a.currentTime; o.start(t); o.stop(t+0.12);
      g.gain.setValueAtTime(0.18,t); g.gain.exponentialRampToValueAtTime(0.001, t+0.12);
    }

    // ===== –°—Ç–∞—Ä—Ç (—Å–∞–º–æ –±—É—Ç–æ–Ω, –Ω–∏—â–æ –¥—Ä—É–≥–æ) =====
    function startGame(){ if(startUI) startUI.style.display='none'; build(); }
    if (playBtn) playBtn.addEventListener('click', startGame);
    // –∫–ª–∏–∫ –≤—ä—Ä—Ö—É –ø—Ä–∞–∑–Ω–æ—Ç–æ –Ω–∞ –æ—É–≤—ä—Ä–ª–µ—è —Å—ä—â–æ —Å—Ç–∞—Ä—Ç–∏—Ä–∞
    if (startUI) startUI.addEventListener('click', (e)=>{ if(e.target===startUI) startGame(); });
    // –∞–∫–æ –±—É—Ç–æ–Ω—ä—Ç –ª–∏–ø—Å–≤–∞ –ø–æ –≥—Ä–µ—à–∫–∞ ‚Äì —Å—Ç–∞—Ä—Ç–∏—Ä–∞–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
    if (!playBtn) startGame();

    // ===== 3√ó3 –≥—Ä–∏–¥ (–±–ª–∏–∑–æ –µ –¥–æ–ª–Ω–∏—è—Ç —Ä–µ–¥) =====
    const rows=3, cols=3; let locked=false;
    function build(){
      grid.innerHTML=''; let idx=1;
      for(let r=0;r<rows;r++){
        for(let c=0;c<cols;c++){
          const cell=document.createElement('div'); cell.className='cell';
          const lab=document.createElement('span');
          const dist = r===2? '–±–ª–∏–∑–æ' : r===1? '—Å—Ä–µ–¥–Ω–æ' : '–¥–∞–ª–µ—á';
          const col = c===0? '–ª—è–≤–æ' : c===1? '—Ü–µ–Ω—Ç—ä—Ä' : '–¥—è—Å–Ω–æ';
          lab.textContent = `${dist} ‚Ä¢ ${col}`; cell.appendChild(lab);
          const num=document.createElement('b'); num.textContent=idx++; cell.appendChild(num);
          cell.addEventListener('click', ()=> cast(r,c,cell));
          grid.appendChild(cell);
        }
      }
      // failsafe: –∞–∫–æ –ø–æ—Ä–∞–¥–∏ —Å—Ä–µ–¥–∞ –Ω–µ —Å–µ –Ω–∞—á–µ—Ä—Ç–∞—è—Ç 9 –∫–ª–µ—Ç–∫–∏, –æ–ø–∏—Ç–∞–π –ø–∞–∫
      setTimeout(()=>{ if(grid.children.length<9){ console.warn('Retry grid build'); build(); } }, 120);
    }

    // ===== –ú–æ–¥–µ–ª =====
    const species = [
      {id:'perch',   name:'–ö–æ—Å—Ç—É—Ä',     emoji:'üêü', w:[0.1,1.2],  depth:[1.0,4.0], wait:[5,40]},
      {id:'pike',    name:'–©—É–∫–∞',       emoji:'ü¶à', w:[0.8,8.0],  depth:[0.5,2.5], wait:[10,60]},
      {id:'zander',  name:'–ë—è–ª–∞ —Ä–∏–±–∞',  emoji:'üê†', w:[0.7,4.5],  depth:[2.0,8.0], wait:[15,120]},
      {id:'catfish', name:'–°–æ–º',        emoji:'üê°', w:[2.0,30.0], depth:[3.0,10.0], wait:[30,180]}
    ];
    // far (top), mid, near (bottom) ‚Üí [perch, pike, zander, catfish]
    const distRowWeights = [
      [0.25, 0.20, 0.45, 0.10],
      [0.40, 0.30, 0.25, 0.05],
      [0.55, 0.30, 0.12, 0.03]
    ];

    // helpers
    const rnd=(a,b)=>Math.random()*(b-a)+a;
    const clamp=(v,a,b)=>Math.max(a, Math.min(b,v));
    const fmtWait=(sec)=>{ if(sec<60) return `${sec} —Å–µ–∫`; const m=Math.floor(sec/60), s=sec%60; return s? `${m} –º–∏–Ω ${s} —Å–µ–∫` : `${m} –º–∏–Ω`; };
    const pickWeighted=(arr)=>{ const x=Math.random(); let acc=0; for(let i=0;i<arr.length;i++){ acc+=arr[i]; if(x<=acc) return i; } return arr.length-1; };

    // UI bits
    function splash(x,y){
      const s=document.createElement('div'); s.className='splash';
      s.style.left = `${x + grid.offsetLeft}px`; s.style.top = `${y + grid.offsetTop}px`;
      ripples.appendChild(s); setTimeout(()=>s.remove(), 1200);
    }
    function spinnerAt(x,y){
      const sp=document.createElement('div'); sp.className='spinner';
      sp.style.left = `${x + grid.offsetLeft}px`; sp.style.top = `${y + grid.offsetTop}px`;
      ripples.appendChild(sp); return sp;
    }
    function bubbleAt(x,y,f,weight,depth,wait){
      const bub=document.createElement('div'); bub.className='bubble';
      bub.style.left = `${x + grid.offsetLeft}px`; bub.style.top = `${y + grid.offsetTop - 10}px`;
      bub.innerHTML = `
        <div class="b-title">${f.emoji} ${f.name}</div>
        <div class="b-row">
          <div>–¢–µ–≥–ª–æ:</div><div>${weight.toFixed(weight<1?2:1)} –∫–≥</div>
          <div>–î—ä–ª–±–æ—á–∏–Ω–∞:</div><div>${depth.toFixed(1)} –º</div>
          <div>–ß–∞–∫–∞–Ω–µ:</div><div>${fmtWait(wait)}</div>
        </div>
        <div class="b-actions"><button class="btn" id="againBtn">–ò–≥—Ä–∞–π –ø–∞–∫</button></div>`;
      ripples.appendChild(bub);
      // –∞–∫–æ –∞–Ω–∏–º–∞—Ü–∏–∏—Ç–µ —Å–∞ –±–ª–æ–∫–∏—Ä–∞–Ω–∏, –≥–∞—Ä–∞–Ω—Ç–∏—Ä–∞–π –≤–∏–¥–∏–º–æ—Å—Ç
      requestAnimationFrame(()=>{ bub.style.opacity='1'; });
      bub.querySelector('#againBtn').addEventListener('click',()=>{ bub.remove(); locked=false; grid.classList.remove('locked'); });
      // –æ—Å–∏–≥—É—Ä–æ–≤–∫–∞: –∞–∫–æ –Ω—è–∫–æ–π –æ—Å—Ç–∞–≤–∏ –±–∞–ª–æ–Ω–∞ —Ç–≤—ä—Ä–¥–µ –¥—ä–ª–≥–æ
      setTimeout(()=>{ if(document.body.contains(bub)){ bub.remove(); locked=false; grid.classList.remove('locked'); } }, 10000);
      return bub;
    }

    function cast(r,c,cell){
      if(locked) return; locked=true; grid.classList.add('locked');

      const rect = cell.getBoundingClientRect();
      const grect = grid.getBoundingClientRect();
      const x = rect.left + rect.width/2 - grect.left;
      const y = rect.top + rect.height/2 - grect.top;

      splash(x,y);

      // –∏–∑–±–µ—Ä–∏ —Ä–∏–±–∞ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏
      const fishId = pickWeighted(distRowWeights[r]); const f = species[fishId];
      const depthAdj = r===2? -0.6 : r===1? 0 : 0.6;
      const weight = rnd(f.w[0], f.w[1]);
      const depth = clamp(rnd(f.depth[0], f.depth[1]) + depthAdj, 0.4, 12);
      const wait = Math.round(rnd(f.wait[0], f.wait[1]));

      const spin = spinnerAt(x,y);
      setTimeout(()=>{
        try{
          spin.remove();
          const isTrophy=(Math.random()<0.06)&&(f.id==='pike'||f.id==='catfish');
          const W=isTrophy?weight*rnd(1.08,1.25):weight;
          const T=isTrophy?wait+10:wait;
          const F={...f}; if(isTrophy) F.name += ' (—Ç—Ä–æ—Ñ–µ–π!)';
          popSound(); // –µ–¥–∏–Ω–µ–Ω –∑–≤—É–∫ —Ç–æ—á–Ω–æ –ø—Ä–∏ –ø–æ–∫–∞–∑–≤–∞–Ω–µ—Ç–æ
          bubbleAt(x,y, F, W, depth, T);
        }catch(err){
          console.error('Reveal error:', err);
          locked=false; grid.classList.remove('locked');
        }
      }, 650);
    }
  }
})();
</script>
</body>
</html>
